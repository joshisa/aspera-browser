<!-- toolbar -->
<mat-toolbar color="primary" class="app-toolbar">
  <p>AsperaBrowser - Angular Sample App to Aspera API</p>
  <span class="app-toolbar-filler"></span>
  <button mat-button (click)="sidenav.toggle()">
    <mat-icon>settings</mat-icon>
  </button>
</mat-toolbar>

<mat-sidenav-container autosize class="app-sidenav-container">

  <!-- side nav -->
  <mat-sidenav #sidenav position="end" mode="over" class="app-sidenav">
    <mat-card>
      <h3> Node API Settings: </h3>
      <form #settings="ngForm">

        <div *ngIf="! config.isFixedURL">
          <mat-form-field class="full-width">
            <mat-placeholder>
              <mat-icon>link</mat-icon> NodeAPI URL
            </mat-placeholder>
            <input matInput #url name="url" [(ngModel)]="uiCred.nodeURL" type="url" required>
          </mat-form-field>
          <br/>
        </div>

        <mat-form-field class="full-width">
          <mat-placeholder>
            <mat-icon>person</mat-icon> User
          </mat-placeholder>
          <input matInput #user autocomplete="username" name="user" [(ngModel)]="uiCred.nodeUser" type="text" required>
        </mat-form-field>
        <br/>

        <mat-form-field class="full-width">
          <mat-placeholder>
            <mat-icon>lock</mat-icon> Password
          </mat-placeholder>
          <input matInput #password autocomplete="current-password" name="password" [(ngModel)]="uiCred.nodePW" [type]="hidePW ? 'password' : 'text'" required>
          <mat-icon matSuffix (click)="hidePW = !hidePW">{{ hidePW ? 'visibility' : 'visibility_off' }}</mat-icon>
        </mat-form-field>

        <div *ngIf="! config.isFixedConnectAuth">
          Connect Client:
          <br>
          <mat-radio-group name="token" [(ngModel)]="uiCred.useTokenAuth">
            <mat-radio-button checked=true [value]="true">token auth / built-in ssh-key</mat-radio-button>
            <br>
            <mat-radio-button [value]="false">ask system user password</mat-radio-button>
          </mat-radio-group>
        </div>

        <p>
          <button mat-raised-button class="test-button" (click)="testconnection()" [disabled]="!settings.valid || !settings.dirty">
            Apply & Save
          </button>
          <mat-icon color="accent" class="test-icon" [ngStyle]=" isConnected ? {color: 'green'} : {} ">{{ isConnected ? 'check_circle' : 'error' }}</mat-icon>
          <span class="status" *ngIf="HTTPerror">Error: {{ HTTPerror.status }} - {{ HTTPerror.statusText }} - {{ HTTPerror.message }} - {{ HTTPerror.error?.code }} - {{ HTTPerror.error?.host }}</span>
        </p>
      </form>
    </mat-card>

    <mat-card>
      <h3> Useful Info: </h3>
      <mat-nav-list dense>
        <a mat-list-item target="_blank" href="https://demo.asperasoft.com">
          <mat-icon color='primary' class="sidenav-icon">link</mat-icon>
          <span class="sidenav-link">Aspera Demoserver</span>
        </a>
      </mat-nav-list>
    </mat-card>
  </mat-sidenav>

  <!-- main page -->
  <mat-sidenav-content>
    <mat-card>

      <!-- header -->
      <mat-card-header>
        <img src="assets/aspera_icon.png" mat-card-avatar>
        <mat-card-title>
          <span class="title">AsperaBrowser</span>
        </mat-card-title>
        <mat-card-subtitle>{{ uiCred.nodeUser }} @ {{ getNodeHostname() }} </mat-card-subtitle>
      </mat-card-header>

      <!-- buttons / status -->
      <mat-card-content>
        <button mat-raised-button color="primary" style="min-width: 110px" (click)="(dirList) ? browse(dirList.self.path) : browse('/')">
          <mat-icon>{{ isConnected ? 'refresh' : 'lock_open' }}</mat-icon>
          {{ isConnected ? 'Refresh' : 'Login ' }}
        </button>
        <button mat-raised-button color="primary" [disabled]="(dirList && selection.selected.length !== 0) ? false : true" (click)="download()">
          <mat-icon>file_download</mat-icon>
          Download
        </button>
        <button mat-raised-button color="primary" [disabled]="(dirList && selection.selected.length === 0) ? false : true" (click)="showSelectFileDialog()">
          <mat-icon>file_upload</mat-icon>
          Upload File
        </button>
        <button mat-raised-button color="primary" [disabled]="(dirList && selection.selected.length === 0) ? false : true" (click)="showSelectFolderDialog()">
          <mat-icon>open_in_browser</mat-icon>
          Upload Folder
        </button>
        <button mat-raised-button color="primary" [disabled]="(dirList && selection.selected.length !== 0) ? false : true" (click)="selection.clear()">
          <mat-icon>clear</mat-icon>
          Clear
        </button>
        <button mat-raised-button color="primary" [disabled]="(dirList && selection.selected.length === 0) ? false : true" (click)="createDirDialog()">
          <mat-icon>folder</mat-icon>
          New Dir
        </button>
        <button mat-raised-button color="accent" [disabled]="(dirList && selection.selected.length !== 0) ? false : true" (click)="deleteDialog()">
          <mat-icon>delete</mat-icon>
          Delete Files
        </button>
        <div class="progressInfo">
          <mat-progress-bar mode="indeterminate" *ngIf="browseInProgress"></mat-progress-bar>
          <span class="status" *ngIf="HTTPerror">Error: {{ HTTPerror.status }} - {{ HTTPerror.statusText }} - {{ HTTPerror.message }} - {{ HTTPerror.error?.code }} - {{ HTTPerror.error?.host }}</span>
        </div>
        <!-- result / table -->
        <p class="path">
          <mat-icon color="primary" class="home-icon" (click)="browse('/')">home</mat-icon>
          <span *ngFor="let ele of breadcrumbNavs">
            <span class="home-slash"> / </span>
            <span class="home-txt" (click)="browse(ele.path)"> {{ ele.dirname }} </span>
          </span>
          <!-- <mat-icon color="accent" *ngIf="(dirList.self.permissions[1].name != 'edit')">lock_outline</mat-icon> -->
          <!-- <mat-icon color="blue"   *ngIf="(dirList.self.permissions[1].name == 'edit')">lock_open</mat-icon> -->
        </p>

        <mat-form-field class="filter">
          <input matInput (keyup)="applyFilter($event.target.value)" placeholder="Filter">
        </mat-form-field>

        <mat-table #table [dataSource]="dataSource" matSort>

          <ng-container matColumnDef="select">
            <mat-header-cell *matHeaderCellDef> {{ selection.selected.length }} </mat-header-cell>
            <mat-cell *matCellDef="let item">
              <mat-checkbox (click)="$event.stopPropagation()" (change)="$event ? selection.toggle(item) : null" [checked]="selection.isSelected(item)">
              </mat-checkbox>
            </mat-cell>
          </ng-container>

          <ng-container matColumnDef="type">
            <mat-header-cell *matHeaderCellDef mat-sort-header> Type </mat-header-cell>
            <mat-cell *matCellDef="let item" (click)="(item.type == 'directory') ? browse(item.path) : 0">
              <mat-icon color="primary" class="folder-icon" *ngIf="(item.type == 'directory')" mat-list-icon>folder</mat-icon>
              <mat-icon *ngIf="(item.type == 'file')" mat-list-icon>insert_drive_file</mat-icon>
            </mat-cell>
          </ng-container>

          <ng-container matColumnDef="basename">
            <mat-header-cell *matHeaderCellDef mat-sort-header> Name </mat-header-cell>
            <mat-cell [ngClass]="(item.type == 'directory') ? 'folder-txt' : 'file-txt' " *matCellDef="let item" (click)="(item.type == 'directory') ? browse(item.path) : 0">
              {{ item.basename }}
            </mat-cell>
          </ng-container>

          <ng-container matColumnDef="size">
            <mat-header-cell *matHeaderCellDef mat-sort-header> Size </mat-header-cell>
            <mat-cell *matCellDef="let item">
              <span *ngIf="(item.type == 'directory')"> </span>
              <span *ngIf="(item.type == 'file')"> {{ item.size | size }}</span>
            </mat-cell>
          </ng-container>

          <ng-container matColumnDef="mtime">
            <mat-header-cell *matHeaderCellDef mat-sort-header> M Time </mat-header-cell>
            <mat-cell *matCellDef="let item"> {{ item.mtime | date:'yyyy-MM-dd HH:mm:ss z' }} </mat-cell>
          </ng-container>

          <mat-header-row *matHeaderRowDef="displayedColumns"></mat-header-row>
          <mat-row *matRowDef="let row; columns: displayedColumns;"></mat-row>
        </mat-table>

        <mat-paginator #paginator [pageSize]="10" [pageSizeOptions]="[10, 20, 30, 50, 100]">
        </mat-paginator>

      </mat-card-content>
      <mat-card-footer>	
      </mat-card-footer>
    </mat-card>
    <div class="version-footer">{{ version_footer }}</div>
  </mat-sidenav-content>

</mat-sidenav-container>